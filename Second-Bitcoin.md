# 目录
- [比特币的简单介绍](#比特币的简单介绍)
- [数字货币VS电子货币](#数字货币VS电子货币)
- [比特币解决的问题](#比特币解决的问题)
- [P2P网络交易原理](#P2P网络交易原理)
  * [数字签名](#数字签名)
    + [公私钥](公私钥)
  * [交易过程](#交易过程)
## 比特币的简单介绍
**比特币是人类历史上第一种数字货币**！

**什么是数字货币？数字货币就是基于数学加密原理构建的不可伪造的货币系统，而比特币是一个基于数据加密原理构建的分布式的数字货币系统**！

**比特币与区块链的关系是什么？一句话概括：比特币使用了区块链技术实现了数字货币的可信支付**！

比特币是2008年10月中本聪在密码学朋克论坛上发表的一篇文章：[比特币：一种点对点的电子现金系统](https://bitcoin.org/bitcoin.pdf)，这个可以看成是比特币的白皮书；随后在2008年11月，中本聪发布了比特币的第一版代码。
2009年1月，中本聪挖出了比特币的第一个区块——创世区块，标志着比特币网络的正式运行。


## 数字货币VS电子货币
其实无论是现金支付还是电子货币支付，交易的过程都需要通过银行这个媒介进行，现金的通过银行则是通过税法来体现，电子货币的交易的通过银行则是第三方机构与银行签订的合约进行！只有通过银行了，国家财政才能知道近年来的货币流转程度，才能知道最近国家的经济情况，从而根据这种情况去印刷新版货币来流入市场，保证经济，防止经济膨胀和经济紧缩。所以，无论任何交易都要通过银行这个机构来进行。

那么数字货币则是不需要一个类似银行的中央信任机构，就可以通过全网的P2P网络进行发行和流通，这听上去不可思议。

## 比特币解决的问题
比特币就是通过技术手段解决了现金电子化后交易的清结算问题！清结算的官方定义是：**对交易数据依据机构和交易类型进行分类汇总，并计算结算金额的过程**。

传统的基于银行机构进行交易，本质上都是通过中央数据库，确保两个交易用户余额的以增一减，这个交易高度依赖开发和运维人员，以及完善的风控机制。

比特币则是通过区块链技术，把整个账本全部公开，人手一份，全网相同，因为，如果个人修改账本，是不会被其他人承认的。

比如：我们现在有一个交易发生，交易金额是M0，并且是A向B出售货物，B向A付款M0，如果通过电子货币进行交易，是不是可以理解为以下流程。B手上目前有银行的M0的负债，也就是B有M0个资产，那么进行交易后，也就是B的资产减少M0，A的资产增加M0，银行向B的负债，现在转化为银行向A的负债。对银行来说整个负债是平衡的。那么如果通过现金，是不是就不用通过银行这个机构进行交易，就不会产生资产与负债的关系。所以通过电子货币，无论怎样都绕不开中央信任机构的问题，因为用户需要信任银行不会篡改余额！

比特币就是可以理解为电子上的现金支付，也就是点对点的支付系统！

## P2P交易原理
比特币既然可以理解为基于电子的现金交易，那么是怎么实现的？是通过一种P2P的交易形式：假如A和B想电子的现金交易的方式进行交易，那么一种创建交易的方式是，A声称自己有1万元，这显然是不可信的；那么如果A对自己的话能够做一个验证，确实有1万元，那么是否可以认定A是可以进行交易；但是这个可信度还是不够，如果能够保证A有这1万元，并且一定会想去交易即可，是不是就可以保证交易是肯定发生的？所以，这个方法就是P2P交易。

确保A有1万元，是交易网络进行判断的，而确保A一定想发生交易，是通过数字签名进行的。

### 数字签名
这个概念就类似于签合同，如果继续上面的例子，如果A想要进行交易，就需要先做一个声明，并且在整个声明上签字，A签字的含义就是：A证明自己拥有1万元，并且保证自己是希望进行交易的。所以数字签名就保证了交易的有效性！！这个签名是通过数据签名算法（公私钥）进行的，比验证笔记更加可行！

#### 公私钥
在数字签名的过程中，每个人都可以自己生成一个密钥对，这个密钥对是包含一个私钥和一个公钥，私钥是自己严格保密的，公钥是可以公开给别人的。在比特币中，公钥是可以公开发布给全网的！

整个签名的过程大致是这样：A对想要进行1万元交易这个消息进行签名的时候，可以用自己的私钥进行签名，然后把这个消息和公钥发布出去，网络上任何人都可以收到这个消息和公钥，而别人想要确认这个消息，就只需要拿公钥去验证，如果验证通过了， 那么就可以完全肯定这个消息是A发出去的。

**而这个公私钥的生成过程也是通过上一个文章所说的Hash进行处理的**。

**一般常用的数字签名的算法有三种：RSA算法、DSA算法和MCDSA算法，比特币采用的签名算法是椭圆曲线签名算法，ECDSA算法，使用的是定义好的标准曲线secp256k1函数**，公式是`y^2 = x^3 + 7` 。

**ECDSA算法需要的是一个私钥来生成一个公钥，并且由私钥是很难推算出公钥的，所以不需要保存公钥**。私钥本质上就是一个1～2^256的随机数， **而比特币的私钥确切的说是比2^256次方要小一点，而比特币的公钥是通过私钥生成的两个256位的整数**！！所以**用户只要提供一个256位的整数组成私钥即可，但是这个私钥最好是通过使用编程语言提供的安全随机数算法来生成**！因为，比特币规定，不可以修改公私钥，并且如果别人获取了你的私钥，那么你无法改动你的账户，他也能轻松获取该账户下的比特币！这里，公钥更像是你的银行卡卡号，私钥则是银行卡密码。

**并且全网所有用户都可以通过公钥来查看你账户中的余额**。

### 交易过程
在比特币中，在区块链上的每个区块，都至少包含一笔交易，并且每个区块的第一个交易通常是CoinBase交易，也就是矿工挖矿的奖励，后续的交易内容才是用户之间的交易。
<br>我们再来看记录在区块链上的交易。每个区块都记录了至少一笔交易，一笔交易就是把一定金额的比特币从一个输入转移到一个输出：
<br>注：这个就可以看作区块链的一部分，新的区块是加在链表的尾部，也就是右边！
![](./images/交易1.png)
例如，小明把两个比特币转移给小红，这笔交易的输入是小明，输出就是小红。实际记录的是双方的公钥地址。

如果小明有50个比特币，他要转给小红两个比特币，那么剩下的48个比特币应该记录在哪？比特币协议规定一个输出必须一次性花完，所以，小明给小红的两个比特币的交易必须表示成：
![](./images/交易2.png)
小明给小红2个比特币，同时小明又给自己48个比特币，这48个比特币就是找零。所以，一个交易中，一个输入可以对应多个输出。

当小红有两笔收入时，一笔2.0，一笔1.5，她想给小白转3.5比特币时，就不能单用一笔输出，她必须把两笔钱合起来再花掉，这种情况就是一个交易对应多个输入和1个输出：
![](./images/交易3.png)
如果存在找零，这笔交易就既包含多个输入也包含多个输出：
![](./images/交易4.png)
在实际的交易中，输入比输出要稍微大一点点，这个差额就是隐含的交易费用，交易费用会算入当前区块的矿工收入中作为矿工奖励的一部分：
![](./images/交易5.png)
当我们要简单验证某个交易的时候，例如，对于交易`f36abd`，它记录的输入是`3f96ab`，索引号是`1`（索引号从`0`开始，`0`表示第一个输出，`1`表示第二个输出，以此类推），我们就根据`3f96ab`找到前面已发生的交易，再根据索引号找到对应的输出是0.5个比特币，所以，这笔交易的输入总计是0.5个比特币，输出分别是0.4个比特币和0.09个比特币，隐含的交易费用是0.01个比特币：
![](./images/交易6.png)
以上就是交易的流程！
